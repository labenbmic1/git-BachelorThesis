%% --------------------------------------------------------------------------------
%% ____           TUM physics package from Michael Labenbacher 2020           _____
%% --------------------------------------------------------------------------------
%% LOAD: LaTeX3-packages: expl3, l3keys2e and xparse,... as "Standard"
%% expl3 = LaTeX3
\RequirePackage{expl3}%
%% xkeyval = Extension of the keyval package
\RequirePackage{xkeyval}%
%% ltxcmds = Some LATEX kernel commands for general use
\RequirePackage{ltxcmds}%
%% kvoptions = Key value format for package options
\RequirePackage{kvoptions}%
%% kvsetkeys = Key value parser with default handler support
\RequirePackage{kvsetkeys}%
%% kvdefinekeys = efine keys for use in the kvsetkeys package
\RequirePackage{kvdefinekeys}%
%% l3keys2e = LaTeX2ε op­tion pro­cess­ing us­ing LaTeX3 keys
%% needed from siunitx
\RequirePackage{l3keys2e}%
%% etex = An extended version of TeX (NTS-project)
\RequirePackage{etex}%
%% etexcmds = Avoid name clashes with e-TeX commands
\RequirePackage{etexcmds}%
%% ifxetex = Am I running under XeTeX?
%% needed by authors (pdflscape)
\RequirePackage{ifxetex}%
%% ifluatex = Provides the \ifluatex switch
\RequirePackage{ifluatex}%
%% etoolbox = eTeX-tools for LaTeX
\RequirePackage{etoolbox}%
%% xparse = A generic document command parser (LaTeX3)
\RequirePackage{xparse}%
%% xparse = Conditional commands in LaTeX documents
%% needed by authors (pdflscape)
\RequirePackage{ifthen}%
%% calc = Simple arithmetic in LaTeX commands
%% needed by authors (pdflscape)
\RequirePackage{calc}%
%% silcence = Selective filtering of error messages and warnings
%% needed for todonotes
\RequirePackage{silence}%
\WarningsOff[todonotes]%


%% ================================================================================
%% ================================================================================
%% ======================== Package-Options (ExplSyntaxOn)  =======================
%% ================================================================================
%% ================================================================================
%% Declaration of the required TeX-format
%% LaTeX2e ... "newest, stable" LaTeX-release (currently)
\NeedsTeXFormat{LaTeX2e}%
%% Version number
\makeatletter%
\def\@TUM@version@hook{001}%
% {scrbook}{\def\@TUM@version@hook{000}}{}%
% {scrreprt}{\def\@TUM@version@hook{001}}{}%
% {scrartcl}{\def\@TUM@version@hook{002}}{}%
% {revtex4-2}{\def\@TUM@version@hook{003}}{}%
% {transcript}{\def\@TUM@version@hook{004}}{}%
% {cheatsheet}{\def\@TUM@version@hook{005}}{}%
\def\TUMversion{1.0.1.nightly.\@TUM@version@hook000000020013}%
\makeatother%
%% Information of the provided package
%% ProvidesExplPackage{name of package}{YYYY-MM-DD}{version}{more information}
%% ExplSyntax is ON after this...
\ProvidesExplPackage {tum-physics} {2020-05-24} {\TUMversion}%
	{A (:P) "package" made by Michael Labenbacher, scrbook/scrreprt}%
%% Output on the command-line in the log-file
\typeout{==========================================================================}
\typeout{Version:~\TUMversion}%
\typeout{000~for:~--~paper=a4,11/12pt,twoside,open=right -- scrbook}%
\typeout{001~for:~--~paper=a4,11/12pt,oneside,open=any -- scrreprt}%
\typeout{002~for:~--~paper=a4,11/12pt,twoside,open=right -- scrartcl}%
\typeout{003~for:~--~a4paper,11/12pt,oneside -- revtex4-2}%
\typeout{004~for:~--~paper=a4,11/12pt,oneside -- scrreprt, (transcript)}%
\typeout{005~for:~--~paper=a3,11/12pt/tiny,oneside -- scrreprt, (cheatsheet)}%
\typeout{Author:~Labenbacher~Michael}%
\typeout{==========================================================================}
%% ----------------------------------- Options ------------------------------------
%% Options: debug (bool), todo (bool), printlist (bool)
\bool_new:N \l_debug_key_bool%
\bool_new:N \l_todo_key_bool%
\bool_new:N \l_notecolumn_key_bool%
\bool_new:N \l_printlist_key_bool%
\keys_define:nn {tum-physics}{%
	debug .bool_set:N = \l_debug_key_bool,%
	debug .default:n  = false,%
	todo .bool_set:N = \l_todo_key_bool,%
	todo .default:n  = false,%
	notecolumn .bool_set:N = \l_notecolumn_key_bool,%
	notecolumn .default:n  = false,%
	printlist .bool_set:N = \l_printlist_key_bool,%
	printlist .default:n  = false,%
}%
\ProcessKeysPackageOptions{tum-physics}%
%% -------- DocumentCommand: TUMRequirePackage and TUMPassOptionsToPackage --------
%% Messages for \TUMRequirePackage
\msg_new:nnn {tum-physics} {require_package/loaded_before_by_you} {}%
\msg_new:nnn {tum-physics} {require_package/loaded_before_by_other} {}%
\msg_new:nnn {tum-physics} {require_package/no_package} {}%
\msg_new:nnn {tum-physics} {require_package/some_loaded_before} {}%
\msg_new:nnn {tum-physics} {require_package/requirements_not_fulfilled} {}%
\msg_new:nnn {tum-physics} {check_package/do_not_load} {}%
\msg_new:nnn {tum-physics} {check_package/requirements_not_fulfilled} {}%
\msg_new:nnn {tum-physics} {pass_optoins_to_package/requirements_not_fulfilled} {}%
\msg_new:nnn {tum-physics} {pass_optoins_to_package/options_passed_to_late} {}%
%% Package <...> must be loaded after/before the packages <...>
%% (!!) very important: See documentation
%% (!) important: ---
\bool_new:N \l_if_package_after_bool%
\prop_new:N \l_package_after_prop%
%% package must be loaded after = {package(s)}
\prop_set_from_keyval:Nn \l_package_after_prop {%
	showframe={ltxcmds,iftex,xcolor},% (!!)
	lipsum={geometry,multicol,babel},% (!!)
	ifpdf={microtype},% (!)
	inputenc={babel},%
	fontenc={scrlayer-scrpage},%
	microtype={babel,upgreek},% (!)
	babel={amsmath},% (!)
	biblatex={scrlayer-scrpage,url},% (!!)
	csquotes={biblatex},% (!!)
	multirow={longtable},%
	nicefrac={graphicx},%
	xfrac={graphicx},% (!)
	graphbox={graphicx},%
	graphics={microtype},% (!)
	color={microtype},% (!)
	pdfpages={pdflscape,graphicx,ifthen,calc},% (!)
	pstricks={microtype},% (!)
	environ={trimspaces},%
	tcolorbox={tikz,pgf,verbatim,etoolbox,environ,listings},% (!!)
	chemformula={xparse, l3keys2e, xfrac, tikz, amstext, nicefrac, scrlfile},%
	chemmacros={upgreek, expl3, xparse, l3keys2e, etoolbox, iftex, ltxcmds, chemgreek, tikz, pgf, graphicx, graphics, xcolor, pgfkeys, pgfmath, amsmath, amsbsy, amstext, amsgen, textcomp, xtemplate, xfrac, nicefrac, ifthen},% (!)
	siunitx={array},%
	nicematrix={tikz, expl3, l3keys2e, array, amsmath, xparse},% (!)
	scrhack={datetime,listings,tcolorbox,tikz},% (!!)
	float={scrhack},% (!!)
	hyperref={scrhack,float,longtable,url,microtype,imakeidx,idxlayout,kvdefinekeys},% (!!)
	nccmath={hyperref},% (!!)
	bookmark={hyperref},% (!!)
	imakeidx={iftex, ifxetex, ifluatex, xkeyval, multicol, babel, scrlayer-scrpage},% (!)
	idxlayout={etoolbox, imakeidx, kvoptions, kvsetkeys, ragged2e, everysel, ltxcmds, babel, scrlayer-scrpage},% (!!)
	kvoptions={ltxcmds},%
	xkeyval={keyval},%
	glossaries={hyperref},% (!!)
	scrlayer-notecolumn={scrlayer-scrpage},% (!)
	todonotes={ifthen, xkeyval, xcolor, tikz, pgf, pgfrcs, pgfsys, pgffor, everyshi, graphicx, graphics, trig, pgfkeys, pgfmath, calc}% (!!)
}%
\bool_new:N \l_if_package_before_bool%
\prop_new:N \l_package_before_prop%
%% package must be loaded before = {package(s)}
\prop_set_from_keyval:Nn \l_package_before_prop {%
	polyglossia={todonotes},%
	ragged2e={idxlayout},%
	everysel={idxlayout},%
	everyshi={todonotes},%
	kvoptions={idxlayout},%
	kvsetkeys={idxlayout},%
	keyval={xkeyval},%
	xkeyval={todonotes},%
	ltxcmds={idxlayout,kvoptions},%
	everysel={ragged2e},%
	microtype={ifpdf,graphics,color,pstricks,hyperref},%
	babel={inputenc,microtype,imakeidx,idxlayout,lipsum},%
	scrlayer-scrpage={fontenc,biblatex,imakeidx,idxlayout},%
	upgreek={microtype,chemmacros},%
	amsmath={babel},%
	url={biblatex,hyperref},%
	biblatex={csquotes},%
	longtable={multirow,hyperref},%
	graphicx={nicefrac,xfrac,graphbox,pdfpages,chemmacros,todonotes},%
	pdflscape={pdfpages},%
	ifthen={pdfpages,chemmacros,todonotes},%
	calc={pdfpages,todonotes},%
	trimspaces={environ},%
	tikz={tcolorbox,chemformula,chemmacros,nicematrix,scrhack,todonotes},%
	pgf={tcolorbox,chemmacros,todonotes},%
	pgfrcs={todonotes},%
	pgffor={todonotes},%
	trig={todonotes},%
	verbatim={tcolorbox},%
	etoolbox={tcolorbox,chemmacros,idxlayout},%
	environ={tcolorbox},%
	listings={tcolorbox,scrhack},%
	xparse={chemformula,chemmacros,nicematrix},%
	l3keys2e={chemformula,chemmacros,nicematrix},%
	xfrac={chemformula,chemmacros},%
	amstext={chemformula,chemmacros},%
	nicefrac={chemformula,chemmacros},%
	scrlfile={chemformula},%
	expl3={chemmacros,nicematrix},%
	iftex={chemmacros,imakeidx},%
	ifxetex={imakeidx},%
	ifluatex={imakeidx},%
	multicol={imakeidx,lipsum},%
	ltxcmds={chemmacros},%
	chemgreek={chemmacros},%
	graphics={chemmacros,lscape,todonotes},%
	xcolor={chemmacros,todonotes,showframe},%
	pgfkeys={chemmacros,todonotes},%
	pgfmath={chemmacros,todonotes},%
	amsmath={chemmacros,nicematrix},%
	amsbsy={chemmacros},%
	amsgen={chemmacros},%
	textcomp={chemmacros},%
	xtemplate={chemmacros},%
	todonotes={menukeys},%
	array={siunitx,nicematrix},%
	datetime={scrhack},%
	tcolorbox={scrhack},%
	scrhack={float,hyperref},%
	float={hyperref},%
	hyperref={nccmath,bookmark,glossaries},%
	geometry={lipsum},%
	imakeidx={hyperref,idxlayout},%
	idxlayout={hyperref}%
}%
%% Packages which must not be loaded due to {...}
%\clist_new:N \l_do_not_load_clist
\prop_new:N \l_do_not_load_prop
\prop_set_from_keyval:Nn \l_do_not_load_prop {%
	circuitikz={Problem~with~circuit.ee},%
	bigfoot={Problem~with~hyperref},%
	footnote={Problem~with~hyperref},%
	hypcap={Out-dated~due~to~caption},%
	subfiles={Not (yet) compatible with pagestyles, gives Warning}%
}%
%% (Example) Store keys of \prop in \clist.
%\cs_new:Npn \get_keys #1#2 {%
%   \clist_put_right:Nn \l_do_not_load_clist {#1}
%}%
%\prop_map_function:NN \l_do_not_load_prop \get_keys
\makeatletter%
\cs_new:Npn \check_do_not_load_packages #1#2 {%
	\@ifpackageloaded{#1}{%
		\msg_set:nnnn {tum-physics} {check_package/do_not_load} {%
			Do~not~load~the~package~#1~(#2).%
		}{}%
		\msg_warning:nn {tum-physics} {check_package/do_not_load}%
	}{}%
}%
%% Load multiple packages
\cs_new_protected:Npn \check_if_multiple_package_loaded:n #1 {%
	\@ifpackageloaded{#1}{}{%
		\clist_put_right:Nn \l_temp_load_packages_clist {#1}%
	}%
}%
%% Packages which must be loaded strictly after <...>-package
\prop_new:N \l_package_end_prop
%% Package order check
\prg_new_conditional:Nnn \@TUM@ifpackageloaded:n {p,T,F,TF}{%
	\use:c {@ifpackageloaded} {#1} {\prg_return_true:} {\prg_return_false:}%
}%
\bool_new:N \l_if_all_packages_loaded_bool%
\cs_new_protected:Npn \check_if_all_packages_loaded:n #1 {% True if all loaded
	\bool_set:Nn \l_if_all_packages_loaded_bool {%
		\bool_lazy_all_p:n {%
			{\@TUM@ifpackageloaded_p:n {#1}}%
			{\l_if_all_packages_loaded_bool}%
		}%
	}%
}%
\bool_new:N \l_if_one_package_loaded_bool%
\cs_new_protected:Npn \check_if_one_package_loaded:n #1 {% True if one loaded
	\bool_set:Nn \l_if_one_package_loaded_bool {%
		\bool_lazy_any_p:n {%
			{\@TUM@ifpackageloaded_p:n {#1}}%
			{\l_if_one_package_loaded_bool}%
		}%
	}%
}%
%% \TUMRequirePackage[options][strictly after]{package}
\clist_new:N \l_load_packages_clist
\int_new:N \l_load_packages_int
\NewDocumentCommand{\TUMRequirePackage}{soom}{%
	\IfBooleanTF{#1}{%
		\msg_redirect_name:nnn {tum-physics} {require_package/loaded_before_by_you} {none}%
		\msg_redirect_name:nnn {tum-physics} {require_package/loaded_before_by_other} {none}%
		\msg_redirect_name:nnn {tum-physics} {require_package/requirements_not_fulfilled} {none}%
		\msg_redirect_name:nnn {tum-physics} {require_package/no_package} {none}%
		\msg_redirect_name:nnn {tum-physics} {require_package/some_loaded_before} {none}%
	}{}%
	\clist_set:Nn \l_load_packages_clist {#4}%
	\clist_remove_duplicates:N \l_load_packages_clist%
	\int_set:Nn \l_load_packages_int {\clist_count:N \l_load_packages_clist}%
	\int_compare:nNnTF {\int_use:N \l_load_packages_int} = {1}{%
		\bool_if_exist:cTF {l_#4_bool} {}{%
			\bool_new:c {l_#4_bool}%
			\bool_set_false:c {l_#4_bool}%
		}%
		\@ifpackageloaded{#4}{%
			\bool_if:cTF {l_#4_bool}{%
				\msg_set:nnnn {tum-physics} {require_package/loaded_before_by_you} {%
					Package~{#4}~already~loaded~before~by~you~with~options~[%
						\clist_use:cnnn {l_#4_options_clist} {,}{,}{,}%
					]%
				}{}%
				\msg_warning:nn {tum-physics} {require_package/loaded_before_by_you}%
			}{%
				\msg_set:nnnn {tum-physics} {require_package/loaded_before_by_other} {%
					Package~{#4}~already~loaded~by~other~package.%
				}{}%
				\msg_warning:nn {tum-physics} {require_package/loaded_before_by_other}%
			}%
		}{%
			\bool_set_true:c {l_#4_bool}%
			\prop_get:NnN \l_package_before_prop {#4} \l_package_before_tl%
			\bool_set:Nn \l_if_package_before_bool {%
				\bool_lazy_any_p:n {%
					{\quark_if_no_value_p:N \l_package_before_tl}%
					{\tl_if_empty_p:N \l_package_before_tl}%
				}%
			}%
			\bool_if:NTF \l_if_package_before_bool {}{%
				% Warning (if): requirements not fulfilled ("package loaded to late")
				\msg_set:nnnn {tum-physics} {require_package/requirements_not_fulfilled} {%
					Package~{#4}~loaded~to~late.~This~package~must~be~loaded~before~{\tl_use:N \l_package_before_tl}.%
				}{}%
				\clist_new:c {l_#4_before_clist}%
				\clist_set:cV {l_#4_before_clist} \l_package_before_tl%
				\bool_set_false:N \l_if_one_package_loaded_bool%
				\clist_map_function:cN {l_#4_before_clist} \check_if_one_package_loaded:n%
				\bool_if:nTF{\l_if_one_package_loaded_bool}{%
					\msg_warning:nn {tum-physics} {require_package/requirements_not_fulfilled}%
				}{}%
			}%
			\prop_get:NnN \l_package_after_prop {#4} \l_package_after_tl
			\bool_set:Nn \l_if_package_after_bool {%
				\bool_lazy_any_p:n {%
					{\quark_if_no_value_p:N \l_package_after_tl}%
					{\tl_if_empty_p:N \l_package_after_tl}%
				}%
			}%
			\bool_if:NTF \l_if_package_after_bool {}{%
				% Warning (if): requirements not fulfilled ("package loaded to early")
				\msg_set:nnnn {tum-physics} {require_package/requirements_not_fulfilled} {%
					Package~{#4}~loaded~to~early.~This~package~must~be~loaded~after~{\tl_use:N \l_package_after_tl}.%
				}{}%
				\clist_new:c {l_#4_after_clist}%
				\clist_set:cV {l_#4_after_clist} \l_package_after_tl%
				\bool_set_true:N \l_if_all_packages_loaded_bool%
				\IfNoValueOrEmptyTF{#3}{}{%
					\clist_remove_all:cn {l_#4_after_clist} {#3}%
				}%
				\clist_map_function:cN {l_#4_after_clist} \check_if_all_packages_loaded:n%
				\IfNoValueOrEmptyTF{#3}{}{%
					\clist_put_right:cn {l_#4_after_clist} {#3}%
				}%
				\bool_if:nTF {\l_if_all_packages_loaded_bool} {}{%
					\msg_warning:nn {tum-physics} {require_package/requirements_not_fulfilled}%
				}%
			}%
			\TUMPassOptionsToPackage*{#2}{#4}%
			\IfNoValueOrEmptyTF{#3}{%
				\RequirePackage{#4}% #4 = \clist_use:Nnnn \l_load_packages_clist {,}{,}{,}
			}{%
				\@ifpackageloaded{#3}{%
					\RequirePackage{#4}%
				}{%
					\AfterAtEndOfPackage{#3}{\RequirePackage{#4}}%
					\prop_put:Nnn \l_package_end_prop {#4} {#3}%
				}%
			}%
		}%
	}{}%
	\int_compare:nNnTF {\int_use:N \l_load_packages_int} < {1}{%
		\msg_set:nnnn {tum-physics} {require_package/no_package} {%
			Select~a~package.%
		}{}%
		\msg_warning:nn {tum-physics} {require_package/no_package}%
	}{}%
	\int_compare:nNnTF {\int_use:N \l_load_packages_int} > {1}{%
		\clist_clear:N \l_temp_load_packages_clist%
		\clist_map_function:NN \l_load_packages_clist \check_if_multiple_package_loaded:n%
		\int_compare:nNnTF {\clist_count:N \l_load_packages_clist} = {\clist_count:N \l_temp_load_packages_clist}{%
			\RequirePackage{#4}%
		}{%
			\msg_set:nnnn {tum-physics} {require_package/some_loaded_before} {%
				Some~packages~from~{\clist_use:Nnnn \l_load_packages_clist {,}{,}{,}}~are~already~loaded.~Loaded~only~{\clist_use:Nnnn \l_temp_load_packages_clist {,}{,}{,}}.%
			}{}%
			\msg_warning:nn {tum-physics} {require_package/some_loaded_before}%
			\RequirePackage{\clist_use:Nnnn \l_temp_load_packages_clist {,}{,}{,}}%
		}%
	}{}%
	\IfBooleanTF{#1}{%
		\msg_redirect_name:nnn {tum-physics} {require_package/loaded_before_by_you} {warning}%
		\msg_redirect_name:nnn {tum-physics} {require_package/loaded_before_by_other} {warning}%
		\msg_redirect_name:nnn {tum-physics} {require_package/requirements_not_fulfilled} {warning}%
		\msg_redirect_name:nnn {tum-physics} {require_package/no_package} {warning}%
		\msg_redirect_name:nnn {tum-physics} {require_package/some_loaded_before} {warning}%
	}{}%
}%
%% \TUMPassOptionsToPackage[strictly if package(s) already loaded]{options}{package}
\bool_new:N \l_if_noValue_or_empty_bool%
\bool_set_true:N \l_if_noValue_or_empty_bool%
\NewDocumentCommand{\TUMPassOptionsToPackage}{somm}{%
	\IfBooleanTF{#1}{%
		\msg_redirect_name:nnn {tum-physics} {pass_optoins_to_package/requirements_not_fulfilled} {none}%
		\msg_redirect_name:nnn {tum-physics} {pass_optoins_to_package/options_passed_to_late} {none}%
		% \msg_redirect_module:nnn { tum-physics } { warning } { none }% all
	}{}%
	\bool_set_true:N \l_if_noValue_or_empty_bool%
	\IfNoValueOrEmptyTF{#2}{%
		\bool_set_true:N \l_if_noValue_or_empty_bool%
	}{%
		\msg_set:nnnn {tum-physics} {pass_optoins_to_package/requirements_not_fulfilled} {%
			The~option(s)~[#3]~for~this~package~{#4}~can~not~be~set,~because~{#2}~is(are)~not~loaded~yet.~%
		}{}%
		\clist_if_exist:cTF {l_#4_option_set_after_clist} {}{\clist_new:c {l_#4_option_set_after_clist}}%
		\clist_set:cn {l_#4_option_set_after_clist} {#2}%
		\bool_set_true:N \l_if_all_packages_loaded_bool%
		\clist_map_function:cN {l_#4_option_set_after_clist} \check_if_all_packages_loaded:n
		\bool_if:nTF{\l_if_all_packages_loaded_bool}{%
			\bool_set_true:N \l_if_noValue_or_empty_bool%
		}{%
			\bool_set_false:N \l_if_noValue_or_empty_bool%
			\msg_warning:nn {tum-physics} {pass_optoins_to_package/requirements_not_fulfilled}%
		}%
	}%
	\clist_if_exist:cTF {l_#4_options_clist} {}{\clist_new:c {l_#4_options_clist}}%
	\bool_if:NTF \l_if_noValue_or_empty_bool {%
		\@ifpackageloaded{#4}{%
			\msg_set:nnnn {tum-physics} {pass_optoins_to_package/options_passed_to_late} {%
				The option(s)~[#3]~could~not~be~passed~to~package~{#4},~because~it~was~already~loaded.%
			}{}%
			\msg_warning:nn {tum-physics} {pass_optoins_to_package/options_passed_to_late}%
		}{%
			\IfValueTF{#3}{%
				\clist_put_right:cn {l_#4_options_clist} {#3}%
			}{}%
			\clist_if_empty:cTF {l_#4_options_clist} {} {%
				\PassOptionsToPackage{\clist_use:cnnn {l_#4_options_clist} {,}{,}{,}}{#4}%
			}%
		}%
	}{}%
	\IfBooleanTF{#1}{%
		\msg_redirect_name:nnn {tum-physics} {pass_optoins_to_package/requirements_not_fulfilled} {warning}%
		\msg_redirect_name:nnn {tum-physics} {pass_optoins_to_package/options_passed_to_late} {warning}%
	}{}%
}%
\makeatother%
\DeclareExpandableDocumentCommand{\IfNoValueOrEmptyTF}{mmm}{%
	\IfNoValueTF{#1}{#2}{%
		\tl_if_empty:nTF {#1} {#2} {#3}%
	}%
}%
%% --------------------- DocumentCommand: TUM@ifpackageloaded ---------------------
\makeatletter%
\msg_new:nnn {tum-physics} {if_package_loaded/optional_argument_unknown} {}%
\msg_new:nnn {tum-physics} {if_package_loaded/can_not_set_settings} {}%
\NewExpandableDocumentCommand{\TUM@ifpackageloaded}{O{normal}mmm}{%
	\str_set:Nn \l_optional_argument_str {#1}%
	\str_case_e:nnTF {\l_optional_argument_str} {{setting}{}{setting=true}{}} {%
		\str_set:Nn \l_optional_argument_str {setting=true}%
	}{}%
	\clist_set:Nn \l_if_clist {#2}%
	\bool_set_true:N \l_if_all_packages_loaded_bool%
	\clist_map_function:NN \l_if_clist \check_if_all_packages_loaded:n%
	\str_case_e:nnTF {\l_optional_argument_str}{%
		{setting=false}{%
			\bool_if:nTF {\l_if_all_packages_loaded_bool}{%
				#3%
				\msg_set:nnnn {tum-physics} {if_package_loaded/can_not_set_settings} {%
					Can~not~set~settings,~because~package/s~{#2}~was/were~loaded~(or/and~package/s~(should)~not~(be)~loaded~normally).%
				}{}%
				\msg_warning:nn {tum-physics} {if_package_loaded/can_not_set_settings}%
			}{#4}%
		}%
		{setting=true}{%
			\bool_if:nTF {\l_if_all_packages_loaded_bool}{#3}{%
				#4%
				\msg_set:nnnn {tum-physics} {if_package_loaded/can_not_set_settings} {%
					Can~not~set~settings,~because~package/s~{#2}~was/were~not~loaded~(or/and~package/s~(should~be)~loaded~normally).%
				}{}%
				\msg_warning:nn {tum-physics} {if_package_loaded/can_not_set_settings}%
			}%
		}%
	}{}{%
		\bool_if:nTF {\l_if_all_packages_loaded_bool}{#3}{#4}%
		\str_if_eq:NNTF {\l_optional_argument_str} {normal} {}{%
			\msg_set:nnnn {tum-physics} {if_package_loaded/optional_argument_unknown} {%
				The~optional~argument~[#1]~is~not~defined.~Proceeded~with~[normal].%
			}{}%
			\msg_warning:nn {tum-physics} {if_package_loaded/optional_argument_unknown}%
		}%
	}%
}%
\makeatother%
%% ----------------------------------- Options ------------------------------------
%% Option (debug):
\makeatletter%
\bool_if:NTF \l_debug_key_bool {%
	\TUMRequirePackage[][xcolor]{showframe}%
	\AtBeginDocument{%
		\TUMRequirePackage{lipsum}%
		\TUMRequirePackage{layout}%
		\listfiles%
		\@ifpackageloaded{array}{%
			\showcols%
		}{}%
	}%
}{}%
\makeatother%
\bool_if:NTF \l_todo_key_bool {}{%
	\TUMPassOptionsToPackage{disable}{todonotes}%
}%
\bool_if:NTF \l_notecolumn_key_bool {%
	%% scrlayer-notecolumn = Control note columns parallel to the main text
	\TUMRequirePackage[][scrlayer-scrpage]{scrlayer-notecolumn}%
}{}%
\bool_if:NTF \l_printlist_key_bool {%
	\AtBeginDocument{%
		\TUMRequirePackage{seqsplit}%
		\listfiles%
	}%
	\AtEndDocument{\printfilelist}%
	\NewDocumentCommand{\printfilelist}{}{%
		\cleardoublepage%
		\addchap{\printfilelistname}%
		\setlength{\LTleft}{\fill}%
		\setlength{\LTright}{\fill}%
		\begin{longtable}{@{}%
			>{\ttfamily}%
			L{0.3\textwidth-\tabcolsep}%
			L{\widthof{9999/99/99}}%
			>{\raggedright}%
			p{0.7\textwidth-\widthof{9999/99/99}-3\tabcolsep}%
			@{}}%
			\toprule%
			\multicolumn{1}{@{}l}{\bfseries File~name} & \multicolumn{1}{c}{\bfseries Date} & \bfseries File~info%
			\tabularnewline%
			\midrule%
			\endhead%
			\bottomrule%
			\endfoot%
			\TUM_print_filelist:%
		\end{longtable}%
	}%
	\tl_new:N \l_TUM_filelist_body_tl%
	\tl_new:N \l_TUM_fileinfo_tl%
	\cs_new_protected:Npn \TUM_print_filelist: {%
		\clist_map_inline:cn {@filelist}{%
			\TUM_print_fileinfo:n {##1}%
		}%
		\tl_use:N \l_TUM_filelist_body_tl%
	}%
	\cs_new_protected:Npn \TUM_print_fileinfo:n #1 {%
		\regex_match:nnT { \.(sty|cls|tex|clo|fd|cfg|bbx|cbx|lbx|ldf|def|hak)\Z } {#1}{%
			\TUM_print_pkginfo:n {#1}%
		}%
	}%
	\cs_new_protected:Npn \TUM_print_pkginfo:n #1 {%
		\tl_set_eq:Nc \l_TUM_fileinfo_tl {ver@#1}%
		\tl_replace_once:Nnn \l_TUM_fileinfo_tl {~} {&}%
		\tl_put_right:Nx \l_TUM_filelist_body_tl {%
			\exp_not:N \seqsplit{#1}%%
			&%
			\exp_not:V \l_TUM_fileinfo_tl%
			\exp_not:N \tabularnewline%
		}%
	}%
}{}%
\ExplSyntaxOff%
\makeatletter%
\AtBeginDocument{%
	\TUM@ifpackageloaded[normal]{babel,seqsplit}{%
		\newcommand*{\printfilelistname}{}%
		\AfterEndPreamble{%
			\addto\extrasnaustrian{%
				\renewcommand*{\printfilelistname}{Verwendete Klasse, Packete und weitere Files.}%
			}%
			\addto\extrasngerman{%
				\renewcommand*{\printfilelistname}{Verwendete Klasse, Packete und weitere Files.}%
			}%
			\addto\extrasamerican{%
				\renewcommand*{\printfilelistname}{Used Class, Packages and other Files}%
			}%
			\addto\extrasenglish{%
				\renewcommand*{\printfilelistname}{Used Class, Packages and other Files}%
			}%
		}%
	}{}%
}%
\makeatother%
\ExplSyntaxOn%
%% ----------------------------------- Checks -------------------------------------
%% Check: Packages which must not be loaded
\AtEndPreamble{%
	\prop_map_function:NN \l_do_not_load_prop \check_do_not_load_packages%
}%
%% Check: Packages which needed to be loaded strictly after <...>-package
\makeatletter%
\AtEndPreamble{%
	\cs_new:Npn \check_requirements #1#2 {%
		\@ifpackageloaded{#2}{}{%
			\msg_set:nnnn {tum-physics} {check_package/requirements_not_fulfilled} {%
				Package~{#1}~could~not~be~loaded.~For~this~package~you~have~to~load~{#2}.%
			}{}%
			\msg_warning:nn {tum-physics} {check_package/requirements_not_fulfilled}%
		}%
	}%
	\prop_map_function:NN \l_package_end_prop \check_requirements%
}%
\makeatother%
\ExplSyntaxOff%


%% ================================================================================
%% ================================================================================
%% ======================= Loading Packages (ExplSyntaxOff) =======================
%% ================================================================================
%% ================================================================================
\typeout{Missing optimization: imakeidx, glossaries, biblatex, listings, theorems, todonotes}%
\typeout{Problem with: etex - paracol (can not be loaded at the same time)}%
%% not loaded:  l3regex, l3docstrips, l3packages, xfp, xtemplate, titlesec,
%%              marginnote, perpage, hyphenat, extdash, cmap, rotating, dcolumn,
%%              parskip, alltt, setspace, moreverb, beramono, fullpage, tabulary,
%%              bold-extra, blindtext, scrextend, tasks, eurosym, marvosym, tabu,
%%              gensymb, mathtext, numprint, luatexja, luatexja-fontspec, luatextra
%% not necessary: textcomp (in 2020 latex-core distribution, but irrelevant)
%% not tested througly: microtype
%% --------------------------------------------------------------------------------


%% amssymb, amstext, sansmath = Mathematische Standardpakete
%% amsmath [intlimits, sumlimits, reqno] = AMS mathematical facilities for LaTeX
%% Options:     integral/sum limits above/below
%%              leqno (Nummer links), reqno (Nummer rechts), fleqn,%
%% amsmath = amstext, amsbsy, amsopn
\TUMRequirePackage[%
intlimits,%
sumlimits,%
reqno%
]{amsmath}%
\TUMRequirePackage{amssymb,amsthm}%
%% mathtools [showonlyrefs] = Mathematical tools to use with amsmath
\TUMRequirePackage[%
showonlyrefs%
]{mathtools}%
%% nccmath = Erweiterte mathematische Faehigkeiten
\TUMRequirePackage[][hyperref]{nccmath}%
%% mathrsfs = Extended mathematics capabilities
\TUMRequirePackage{mathrsfs}%
%% aligned-overset = z.B. \overset{...}&{=}
\TUMRequirePackage{aligned-overset}%
%% tensor = Typeset tensors (there is and can't be no conflict with other packages)
\TUMRequirePackage{tensor}%
%% physics = Erweiterung um physikalische/mathematische Inhalte
\TUMRequirePackage{physics}%

%% babel [naustrian,english] = Multilingual support for Plain TeX or LaTeX
%%       [..., first language]
\TUMRequirePackage[%
naustrian,%
main=american%
]{babel}%
%% inputenc =
\TUMRequirePackage[%
utf8%
]{inputenc}%
%% ulem = (redefines \@empty, also zur Sicherheit for Koma-Script)
\TUMRequirePackage[%
normalem%
]{ulem}%

%% everysel = Provides hooks into \selectfont
\TUMRequirePackage{everysel}%
%% ragged2e = Alternative versions of "ragged"-type commands
\TUMRequirePackage[%
originalcommands,%
newparameters,%
]{ragged2e}%

%% scrlayer-scrpage = Define and manage page styles
\TUMRequirePackage[%
automark,% atuomark statt manualmark (kann nachher noch geaendert werden immer)%
ilines,% Standard für die Ausrichtung der Trennlinien von Kopf- und Fusszeilen%
pagestyleset=KOMA-Script,% Standardeinstellung der Kopf- und Fusszeilen%
autooneside=false% Erlaube auch einseitig \automark[section]{chapter}%
]{scrlayer-scrpage}%
\TUMRequirePackage{scrdate}%
\TUMRequirePackage{scrtime}%
%% tocbasic = Management of tables/lists of contents (and the like)
\makeatletter%
\@ifundefined{KOMAClassName}{%
	\TUMRequirePackage{tocbasic}%
}{%
	\TUMRequirePackage*{tocbasic}% (should be) already loaded with KomaClass
}%
\makeatother%

%% fontenc (Standard - 2020, "not a package anymore")
\TUMRequirePackage[%
T1%
]{fontenc}%
%% ================== Definition, etc. of the used font's =========================
%% --------------------------- Latin Modern font family ---------------------------
%% lmodern = Latin Modern fotns
\TUMRequirePackage{lmodern}%
%% LM Roman
\renewcommand{\rmdefault}{lmr}%
%% LM Mono
\renewcommand{\ttdefault}{lmtt}%
%% LM Sans
%\renewcommand{\sfdefault}{lmss}%
%% ------------------------------ Bera font family ------------------------------
%% bera = Bera fonts
%\RequirePackage{bera}%
%% Bera Serif
%\RequirePackage{beraserif}% {fve}
%% Bera Mono
%\RequirePackage{beramono}% {fvm}
%% Bera Sans
%\RequirePackage{berasans}% {fvs}
%% ----------------------------- CmBright font family -----------------------------
%% cmbright = Computer Modern Bright fonts
%\RequirePackage{cmbright}%
%% CmBright Mono
%\renewcommand{\ttdefault}{cmtl}%
%% CmBright Sans
%\renewcommand{\sfdefault}{cmbr}%
%% ----------------------------- Further font families ----------------------------
%% helvet [scaled] = Load Helvetica, scaled
\TUMRequirePackage[%
scaled%
]{helvet}%
\renewcommand{\sfdefault}{phv}%
%\RequirePackage{courier}%
%\renewcommand{\ttdefault}{pcr}%
%\RequirePackage{mathptmx}%
%\renewcommand{\rmdefault}{ptm}%
%\RequirePackage{mathpazo}%
%\renewcommand{\rmdefault}{pplx}% or {pplj}
%\RequirePackage{charter}%
%\renewcommand{\sfdefault}{bch}%
%\RequirePackage{bookman}%
%\renewcommand{\sfdefault}{pbk}%
%% further fonts:   newcent {pnc}, avantgar {pag}, chancery {pzc},
%%                  uarial {ua1}, ulgothic {ulg}, luximono {ul9}, fourier {futm}, ..
%% ------------------------- Default fonts of the document ------------------------
\renewcommand{\familydefault}{\rmdefault}%
%% ---------------------------- Sans font in math mode ----------------------------
%\RequirePackage{sansmath}%
%\sansmath%
%% ---------------------------- Bbm font in math mode -----------------------------
%% bbm = \mathbbm{...}, for example 1 (identity matrix)
\TUMRequirePackage{bbm}%
%% ---------------------------- Upright Greek letters -----------------------------
%% upgreek = upright greek letters (z.B. \upmu)
\TUMRequirePackage{upgreek}%
%% ------------------------- Typographical perfection(s) --------------------------
%% microtype = subliminal refinements towards typographical perfection
%% after: font(s),
\TUMRequirePackage[%
babel=true,%
]{microtype}%

%% multicol = Intermix single and multiple columns
\TUMRequirePackage{multicol}%
%% imakeidx = A package for producing multiple indexes
\TUMRequirePackage[%
splitindex%
]{imakeidx}%
%% idxlayout = Configurable index layout, responsive to KOMA-Script and memoir
\TUMRequirePackage[%
columns=2,%
%unbalanced,% last page
itemlayout=abshang%
]{idxlayout}%

%% url = Verbatim with URL-sensitive line breaks
\TUMRequirePackage[%
hyphens,%
]{url}%
%% biber = with: --validate-control --convert-control %
\TUMRequirePackage[%
%% default backend of biblatex (bibtex, bibtex8)
backend=biber,%
%% .cbx-file numeric style in the "Text", when using \cite (numeric, numeric-comp)
citestyle=numeric,%
%% .bbx-file numeric style in the bibliography (numeric, numeric-comp)
bibstyle=numeric,%
%% citation order ([nty ... sort by name, title, year], ...
%% or declare a sorting scheme with \DeclareSortingScheme)
sorting=none,%
%% style loads .cbx,.bbx-file at once (overrides bib/cite), ieee=numeric/unsorted
%style=ieee,% changes names...
%% changes are possible here:
natbib=true,%               aliases for citation commands, like the natbib package
backref=true,%              reference back from the bibliography
backrefstyle=two,%          (e. g. two, three)
language=auto,%             language for the whole bibliograpies,
%                           will be set by the otherlanguage-environment:
autolang=other,%            if you want to change the language
alldates=year,%             basicly only the year
dateabbrev=false,%          disable abbreviations
url=true,%                  urls true
doi=true,%                  doi true
urldate=long,%
%% refsection=section
%% datamodel=dbmauthoryear%    .dbx-file (additional definitions)
]{biblatex}%

%% csquotes = Context sensitive quotation facilities
%% first language ... main
%% naustrian alias for: austrian
%% english: american
\TUMRequirePackage[%
autostyle=true,%
english=american,%
austrian=quotes,%
german=quotes,%
]{csquotes}%

%% array = Extending the array and tabular environments
%% --> needed by authors (siunitx)
\TUMRequirePackage{array}%
%% siunitx = A comprehensive (SI) units package
\TUMRequirePackage{siunitx}%

%% setspace = Set space between lines
%% default: \singlespacing (ev. \onehalfspacing, if desired)
\TUMRequirePackage[%
singlespacing%
]{setspace}%
%% graphics = Standard LaTeX graphics
\TUMRequirePackage{graphics}%
%% lscape = Place selected parts of a document in landscape
\TUMRequirePackage{lscape}%
%% pdflscape = Make landscape pages display as landscape
\TUMRequirePackage{pdflscape}%

%% tabularx = Tabulars with adjustable-width columns
\TUMRequirePackage{tabularx}%
\TUMRequirePackage{booktabs}%
%% longtable =  Allow tables to flow over page boundaries
\TUMRequirePackage{longtable}%
%% multirow = Create tabular cells spanning multiple rows
\TUMRequirePackage[%
longtable%
]{multirow}%
%% Colors: needs booktabs, must be loaded before hyperref:
\TUMRequirePackage{packages/tumcolors}%

%% graphicx = Enhanced support for graphics
\TUMRequirePackage{graphicx}%
%% graphbox = Extension of graphicx (loads graphicx)
\TUMRequirePackage{graphbox}%
%% nicefrac = Typeset in-line fractions in a "nice" way
\TUMRequirePackage{nicefrac}%
%% xfrac =  Split-level fractions in LaTeX2ε*
\TUMRequirePackage{xfrac}%
%% subfig [lofdepth] = Figures broken into subfigures (not recommended)
%\RequirePackage[lofdepth,labelformat=simple,listofformat=subsimple,%
%   subrefformat=subsimple,labelsep=period]{subfig}%
%% subfloat [countmax] = Sub-numbering for figures and tables (not recommended)
%\RequirePackage[countmax]{subfloat}%
%% caption [hypcap=true] = Customising captions in floating environments
%% --> loads: caption3
\TUMRequirePackage[%
hypcap=true%
%margin=10pt% margin left and right
]{caption}%
%% subcaption [list=true,hypcap=true] = Support for sub-captions
\TUMRequirePackage[%
list=true,%
hypcap=true%
]{subcaption}%
%% pdfpages = Include PDF documents in LaTeX
\TUMRequirePackage{pdfpages}%

%% enumitem = Control layout of itemize, enumerate, description
\TUMRequirePackage{enumitem}%
%% easylist [ampersand] = Lists using a single active character
\TUMRequirePackage[%
ampersand%
]{easylist}%

%% tikz,pgf = Create PostScript and PDF graphics in TeX
%% (tikz loads pgf)
%% (pgfplotstable loads pgfplots, pgf)
%% Most important commands:
%% \node (name) [object] at (coordinate) {caption};
%% \coordinate (name) at (coordinate);
%% \draw (coordinate) -- (coordinate) to [element] (coordinate);
\TUMRequirePackage{tikz}%
\TUMRequirePackage{pgfplotstable}%

%% listings = Typeset source code listings using LaTeX
\TUMRequirePackage[%
procnames%
]{listings}%

%% todonotes = Marking things to do in a LaTeX document
\TUMRequirePackage[%
colorinlistoftodos,%
textsize=tiny%
]{todonotes}%
%% marginnote = Notes in the margin, even where \marginpar fails
%% needed for todonotes (Better would be also to load scrlayer-notecolumn
%%      if one want to write important stuff into the margin.)
\TUMRequirePackage{marginnote}%
\makeatletter%
\TUM@ifpackageloaded[setting]{marginnote}{%
	\renewcommand{\marginpar}{\marginnote}%
	%\reversemarginpar%
}{}%
\makeatother%

%% tcolorbox = Coloured boxes, for LaTeX examples and theorems, etc.
\TUMRequirePackage{verbatim}%
\TUMRequirePackage{trimspaces}%
\TUMRequirePackage{environ}%
\TUMRequirePackage{tcolorbox}%

%% mhchem = Typeset chemical formulae/equations and Risk and Safety phrases
%% --> older version of chemformula
%% [version=4]
%% chemformula = Command for typesetting chemical formulas and reactions
\TUMRequirePackage{chemformula}%
%% chemgreek =  Upright Greek letters in chemistry
\TUMRequirePackage{chemgreek}%
%% chemmacros = A collection of macros to support typesetting chemistry documents
\TUMRequirePackage{chemmacros}%
%% nicematrix = Improve the typesetting of mathematical matrices with PGF
\TUMRequirePackage{nicematrix}%

%% geometry [pass] = Flexible and complete interface to document dimensions
%% --> pass: only loading, e.q. for addtotoc (pdf)
\TUMRequirePackage[%
pass%
]{geometry}%

%% datetime = Change format of \today with commands for current time
%% --> (for e. g. \monthname + scrdate + scrtime)
\TUMRequirePackage{datetime}%
%% scrhack = Fixes mistakes from important packages
\TUMRequirePackage{scrhack}%
%% float =  Improved interface for floating objects
\TUMRequirePackage{float}%
%% hyperref [...] = for hyperlinks
%% bookmark-commands for hyperref/bookmark
\makeatletter%
\newcommand{\pdfauthor}[1]{\gdef\@pdfauthor{#1}}%
\newcommand{\@pdfauthor}{\@latex@warning@no@line{No \noexpand\pdfauthor given}}%
\newcommand{\pdftitle}[1]{\gdef\@pdftitle{#1}}%
\newcommand{\@pdftitle}{\@latex@warning@no@line{No \noexpand\pdftitle given}}%
\newcommand{\pdfsubject}[1]{\gdef\@pdfsubject{#1}}%
\newcommand{\@pdfsubject}{\@latex@warning@no@line{No \noexpand\pdfsubject given}}%
\newcommand{\pdfkeywords}[1]{\gdef\@pdfkeywords{#1}}%
\newcommand{\@pdfkeywords}{\@latex@warning@no@line{No \noexpand\pdfkeywords given}}%
\makeatother%
%% bookmark's-package overwrites (copies) following hyperref-option's
% [bookmarks=true] --No option available (disable for example with hyperref)
% [bookmarksopen=true] -- [open]
% [bookmarksopenlevel=0] -- [openlevel=0]
% [bookmarksnumbered=true] -- [numbered]
% [bookmarksdepth] -- [depth]
\TUMRequirePackage[%
bookmarks=true,%        %% enable bookmarks
hyperfootnotes=false,%  %% = false, to ensure that KOMAoptions{footnotes=multiple}
unicode=true%
]{hyperref}%
\hypersetup{%
pdftoolbar=true,% (standard)
pdfmenubar=true,% (standard)
colorlinks=true,%       %% colored links
linkbordercolor={1 1 1},%% frame color
linkcolor=\TUMcolor{2},%%% link color
urlcolor=\TUMcolor{3},% %% url color
urlbordercolor={1 1 1},%%% url border color
menucolor=\TUMcolor{4},%% menu color
menubordercolor={1 1 1},%%% menu border color
citecolor=\TUMcolor{1},%% cite color
citebordercolor={1 1 1},%%% cite border color
breaklinks=true,%       %% enable breaking links in listof...
linktocpage=true,%      %% true = only page numbers in toc are hyperlinks + color
hypertexnames=true,%    %% because of biblatex-backref
plainpages=false%       %% biblatex is possible
}%
\makeatletter%
\if@twoside%
	\hypersetup{pdfpagelayout=TwoPageRight}%
\else%
	\hypersetup{pdfpagelayout=OneColumn}%
\fi%
%% Ever break the urls:
\expandafter\def\expandafter\UrlBreaks\expandafter{\UrlBreaks%
	\do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j%
	\do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t%
	\do\u\do\v\do\w\do\x\do\y\do\z\do\A\do\B\do\C\do\D%
	\do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N%
	\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X%
	\do\Y\do\Z\do\_\do\-\do\+\do\-\do\/\do\.\do\1\do\2%
	\do\3\do\4\do\5\do\6\do\7\do\8\do\9\do\0\do\,}%
\Urlmuskip = 0mu plus 1mu%
\TUM@ifpackageloaded[setting]{biblatex}{%
	\setcounter{biburlnumpenalty}{1000}%
	\setcounter{biburlucpenalty}{1000}%
	\setcounter{biburllcpenalty}{1000}%
}{}%
%% Ref/Autoref-names for hyperref
\AtBeginDocument{%
	\TUM@ifpackageloaded[setting]{babel,hyperref}{% begin: babel, hyperref loaded
		\TUM@ifpackageloaded[setting]{listings}{% begin: listings loaded
			\newcommand*{\lstlistingautorefname}{}%
		}{}% end: listings not loaded
		\AfterEndPreamble{%
			\addto\extrasamerican{%
				\renewcommand*{\tableautorefname}{table}%
				\renewcommand*{\figureautorefname}{figure}%
				\renewcommand*{\partautorefname}{part}%
				\renewcommand*{\chapterautorefname}{chapter}%
				\renewcommand*{\sectionautorefname}{section}%
				\renewcommand*{\subsectionautorefname}{subsection}%
				\renewcommand*{\subsubsectionautorefname}{subsubsection}%
				\renewcommand*{\paragraphautorefname}{paragraph}%
				\renewcommand*{\subparagraphautorefname}{subparagraph}%
				\renewcommand*{\equationautorefname}{equation}%
				\renewcommand*{\appendixautorefname}{appendix}%
			}%
			\addto\extrasenglish{%
				\renewcommand*{\tableautorefname}{table}%
				\renewcommand*{\figureautorefname}{figure}%
				\renewcommand*{\partautorefname}{part}%
				\renewcommand*{\chapterautorefname}{chapter}%
				\renewcommand*{\sectionautorefname}{section}%
				\renewcommand*{\subsectionautorefname}{subsection}%
				\renewcommand*{\subsubsectionautorefname}{subsubsection}%
				\renewcommand*{\paragraphautorefname}{paragraph}%
				\renewcommand*{\subparagraphautorefname}{subparagraph}%
				\renewcommand*{\equationautorefname}{equation}%
				\renewcommand*{\appendixautorefname}{appendix}%
			}%
			\addto\extrasnaustrian{%
				\renewcommand*{\tableautorefname}{Tabelle}%
				\renewcommand*{\figureautorefname}{Abbildung}%
				\renewcommand*{\partautorefname}{Teil}%
				\renewcommand*{\chapterautorefname}{Kapitel}%
				\renewcommand*{\sectionautorefname}{Abschnitt}%
				\renewcommand*{\subsectionautorefname}{Unterabschnitt}%
				\renewcommand*{\subsubsectionautorefname}{Unterunterabscnhitt}%
				\renewcommand*{\paragraphautorefname}{Paragraph}%
				\renewcommand*{\subparagraphautorefname}{Unterparagraph}%
				\renewcommand*{\equationautorefname}{Gleichung}%
				\renewcommand*{\appendixautorefname}{Anhang}%
			 }%
			\addto\extrasngerman{%
				\renewcommand*{\tableautorefname}{Tabelle}%
				\renewcommand*{\figureautorefname}{Abbildung}%
				\renewcommand*{\partautorefname}{Teil}%
				\renewcommand*{\chapterautorefname}{Kapitel}%
				\renewcommand*{\sectionautorefname}{Abschnitt}%
				\renewcommand*{\subsectionautorefname}{Unterabschnitt}%
				\renewcommand*{\subsubsectionautorefname}{Unterunterabscnhitt}%
				\renewcommand*{\paragraphautorefname}{Paragraph}%
				\renewcommand*{\subparagraphautorefname}{Unterparagraph}%
				\renewcommand*{\equationautorefname}{Gleichung}%
				\renewcommand*{\appendixautorefname}{Anhang}%
			 }%
		}%
		\TUM@ifpackageloaded[setting]{listings}{% begin: listings loaded
			\AfterEndPreamble{%
				\addto\extrasamerican{%
					\renewcommand*{\lstlistingautorefname}{listing}%
				}%
				\addto\extrasenglish{%
					\renewcommand*{\lstlistingautorefname}{listing}%
				}%
				\addto\extrasnaustrian{%
					\renewcommand*{\lstlistingautorefname}{Listing}%
				}%
				\addto\extrasngerman{%
					\renewcommand*{\lstlistingautorefname}{Listing}%
				}%
			}%
		}{}% end: listings not loaded
		\TUM@ifpackageloaded[setting]{subcaption}{% begin: subcaption loaded
			\AfterEndPreamble{%
				\addto\extrasamerican{%
					\renewcommand*{\subfigureautorefname}{figure}%
					\renewcommand*{\subtableautorefname}{table}%
				}%
				\addto\extrasenglish{%
					\renewcommand*{\subfigureautorefname}{figure}%
					\renewcommand*{\subtableautorefname}{table}%
				}%
				\addto\extrasnaustrian{%
					\renewcommand*{\subfigureautorefname}{Abbildung}%
					\renewcommand*{\subtableautorefname}{Tabelle}%
				}%
				\addto\extrasngerman{%
					\renewcommand*{\subfigureautorefname}{Abbildung}%
					\renewcommand*{\subtableautorefname}{Tabelle}%
				}%
			}%
		}{}% end: subcaption not loaded
	}{}% end: babel, hyperref not loaded
}% end: AtBeginDocument
\makeatother%
%% bookmark = A new bookmark (outline) organization for hyperref
\TUMRequirePackage[%
open,% display the bookmarks when opening the documnet
openlevel=0,% display the bookmarks at level when opening the document 
depth=2,% (max) depth of the bookmarks (= tocdepth (see tumtoc.sty))
numbered,% number the bookmarks 
][hyperref]{bookmark}%


%% ================================================================================
%% ================================================================================
%% ========================== Macros / Definitions / etc. =========================
%% ================================================================================
%% ================================================================================


%% ================================================================================
%% ============================== line/rule-width's *******************************
%% ********************************************************************************
%% Set the width of the rules
\newlength{\rulewidth}%
\setlength{\rulewidth}{0.4pt}%
%% ================================================================================
%% ===================================== math *************************************
%% ********************************************************************************
\DeclareMathOperator{\dAlembert}{\Box}%
\DeclareMathOperator{\Laplace}{\Delta}%
\DeclareMathOperator{\sgn}{sgn}%
%% Redefine vector
\let\oldvec\vec%
\renewcommand{\vec}[1]{\boldsymbol{\mathbf{#1}}}%
\newcommand{\evec}[1]{\boldsymbol{\mathbf{\hat{#1}}}}%
%\newcommand{\evec}[1]{\hat{#1}}%
\makeatletter%
\TUM@ifpackageloaded[setting]{physics}{%
%\renewcommand\Re[1]{%
%    \real{#1}%
%}%
%\renewcommand\Im[1]{%
%    \imaginary{#1}%
%}%
%% Fehler im physics package, vphantom entfernt (steht unnoetig drinnen...),
\RenewDocumentCommand\bra{sm t\ket sg}{%
	\IfBooleanTF{#3}{% Contraction
		\IfBooleanTF{#1}{% Bra has a star: no resize
			\IfNoValueTF{#5}{%
				\braket*{#2}{}\IfBooleanTF{#4}{*}{}%
			}{%
				\braket*{#2}{#5}%
			}%
		}{%
			\IfBooleanTF{#4}{% Ket has a star: no resize
				\IfNoValueTF{#5}{%
					\braket{#2}{}*%
				}{%
					\braket*{#2}{#5}%
				}%
			}{% Neither term is starred: auto sizing
				\braket{#2}{\IfNoValueTF{#5}{}{#5}}%
			}%
		}%
	}%
	{% No contraction
		\IfBooleanTF{#1}{%
			\left\langle\smash{#2}\right\rvert%
		}{%
			\left\langle{#2}\right\rvert%
		}%
		\IfBooleanTF{#4}{*}{}%
		\IfNoValueTF{#5}{}{#5}%
	}%
}%
\RenewDocumentCommand\ket{sm}{%
	\IfBooleanTF{#1}{% No resize
		\left\lvert\smash{#2}\right\rangle%
	}{% Auto resize
		\left\lvert{#2}\right\rangle%
	}%
}%
\RenewDocumentCommand\innerproduct{smg}{%
	\IfBooleanTF{#1}{% No resize
		\IfNoValueTF{#3}{%
			\left\langle\smash{#2}\middle\vert\smash{#2}\right\rangle%
		}{%
			\left\langle\smash{#2}\middle\vert\smash{#3}\right\rangle%
		}%
	}{% Auto resize
		\IfNoValueTF{#3}{%
			\left\langle{#2}\middle\vert{#2}\right\rangle%
		}{%
			\left\langle{#2}\middle\vert{#3}\right\rangle%
		}%
	}%
}%
\RenewDocumentCommand\matrixelement{ssmmm}{%
	\IfBooleanTF{#1}{%
		\IfBooleanTF{#2}{% Double starred: total resizing,
			\left\langle{#3}\middle\vert{#4}\middle\vert{#5}\right\rangle%
		}{% Starred: no resizing,
			\left\langle\smash{#3}\middle\vert\smash{#4}\middle\vert\smash{#5}\right\rangle%
		}%
	}{% Normal: only resize based on bra/ket arguments,
		\left\langle{#3}\middle\vert\smash{#4}\middle\vert{#5}\right\rangle%
	}%
}%
\RenewDocumentCommand\outerproduct{smg}{%
	\IfBooleanTF{#1}{% No resize
		\IfNoValueTF{#3}{%
			\left\lvert\smash{#2}\middle\rangle\!\middle\langle\smash{#2}\right\rvert%
		}{%
			\left\lvert\smash{#2}\middle\rangle\!\middle\langle\smash{#3}\right\rvert%
		}%
	}{% Auto resize
		\IfNoValueTF{#3}{%
			\left\lvert{#2}\middle\rangle\!\middle\langle{#2}\right\rvert%
		}{%
			\left\lvert{#2}\middle\rangle\!\middle\langle{#3}\right\rvert%
		}%
	}%
}%
\RenewDocumentCommand\expectationvalue{ssmg}{%
	\IfNoValueTF{#4}{%
		\IfBooleanTF{#1}{% Starred implicit form: no resizing,
			\left\langle\smash{#3}\right\rangle%
		}{% Normal implicit form: auto sizing,
			\left\langle{#3}\right\rangle%
		}%
	}{%
		\IfBooleanTF{#1}{%
			\IfBooleanTF{#2}{% Double starred explicit form: total auto sizing,
				\left\langle{#4}\middle\vert{#3}\middle\vert{#4}\right\rangle%
			}{% Starred explicit form: no resizing,
				\left\langle\smash{#4}\middle%
				\vert\smash{#3}\middle\vert\smash{#4}\right\rangle%
			}%
		}{% Normal explicit form: only resize based on bra/ket arguments,
			\left\langle{#4}\middle\vert\smash{#3}\middle\vert{#4}\right\rangle%
		}%
	}%
}%
}{}%
\makeatother%
%% ================================================================================
%% ============================ tikz and pgf-plot's *******************************
%% ********************************************************************************
\makeatletter%
\TUM@ifpackageloaded[setting]{pgfplotstable}{%
	\usepgfplotslibrary{external}%
}{}%
%% TikZ (external) and pdfpages -- Fix with [optimize command away=\includepdf]
%% TikZ (external) and geometry (showframe=true) -- Fix see below
%% TikZ (external) and showframe -- Fix see below
%% TikZ (external) and nicematrix -- Fix: add locally (nicematrix): \tikzset{external/optimize=false}
%% TikZ (external) and chemformula -- Fix: see below (add locally inside ex.tikz-environment: \setchemformula{tikz-external-disable=false}%)
%% TikZ (external) and todonotes -- Normal way to fix:
% Use \tikzset{external/export=false}% (local) and only activate it before a
% tikz-picture you want to externalize and set it back to false after.
%% TikZ (external) and imakeidx -- Three ways to fix:
% 1.    Load \makeindex before \tikzexternalize
%       Remaining problem (*): only working if no [name=] given as option in \makeindex)
% 2.    Use [optimize command away=\printindex] (and 1) to fix the Problem (*)
%       Remaining problem (**): only working in combination with 1 and adds the file .idx during optimization due to 1.)
% 3.    Use \tikzifexternalizing{...} is working in every situation
%% --> Use 3 (+2 to be on the save side).
\TUM@ifpackageloaded[setting]{pdfpages}{%
	\TUM@ifpackageloaded[setting]{imakeidx}{%
		\tikzexternalize[%
			optimize command away=\includepdf,%
			optimize command away=\printindex, optimize command away=\makeindex%
			]% (*)
	}{%
		\tikzexternalize[%
			optimize command away=\includepdf%
		]%
	}%
}{%
	\TUM@ifpackageloaded[setting]{imakeidx}{%
		\tikzexternalize[%
			optimize command away=\printindex, optimize command away=\makeindex%
		]% (*)
	}{%
		\tikzexternalize%
	}%
}%
\TUM@ifpackageloaded{showframe}{%
	\tikzifexternalizing{%
		\renewcommand\ShowFramePicture{}%
	}{}%
}{}%
\TUM@ifpackageloaded[setting]{geometry}{%
	\tikzifexternalizing{%
		\setkeys{Gm}{showframe=false}%
	}{}%
}{}%
\TUM@ifpackageloaded[setting]{imakeidx}{%
	\tikzifexternalizing{% after \tikzexternalize
		\renewcommand\index[2][]{}%
		\renewcommand\printindex{}% (**)
		\renewcommand\makeindex[1][]{}% (**)
   }{}%
}{}%
\TUM@ifpackageloaded[setting]{pgfplotstable}{%
	\tikzsetexternalprefix{images/tikz/}%
	\tikzset{external/export=false}%
}{}%
\TUM@ifpackageloaded[setting]{tcolorbox}{%
	\tcbset{shield externalize}%
}{}%
\TUM@ifpackageloaded[setting]{chemformula}{%
	\setchemformula{tikz-external-disable=true}%
}{}%
\makeatother%
%% \tikzexternaldisable% (global)
%% \tikzset{external/export=false}% (local)
%% Standard, locally enable it, if tikzexternalize = true (external/export=true)
\makeatletter%
\TUM@ifpackageloaded[setting]{pgfplotstable}{%
	\usepgfplotslibrary{fillbetween}% fuer z.~B. den Befehl fillbetween
}{}%
\TUM@ifpackageloaded[setting]{tikz}{%
	\usetikzlibrary{positioning}% nodes below/above of ...
	\usetikzlibrary{backgrounds}%% \begin{scope}[on background layer]
	\usetikzlibrary{circuits}%
	\usetikzlibrary{circuits.ee}%
	\usetikzlibrary{circuits.ee.IEC}%% loads pgf library: shapes.gates....
	\usetikzlibrary{circuits.logic}%
	\usetikzlibrary{circuits.logic.US}%% loads pgf library: shapes.gates....
	\usetikzlibrary{circuits.logic.IEC}%% loads pgf library: shapes.gates....
	\usetikzlibrary{decorations}% fuer z.B. Pfeilen entlang von Linien
	\usetikzlibrary{bending}% fuer z.B. gebogene Kurven
	\usetikzlibrary{intersections}% fuer z.B. Schnittpunkte
	\usetikzlibrary{patterns}% fuer z.B. Schattierungen
	\usetikzlibrary{shapes.misc}% fuer z.B. cross node
	\usetikzlibrary{shadows}%
}{}%
\TUM@ifpackageloaded[setting]{pgfplotstable,tikz}{%
	\TUMRequirePackage{packages/tumtikz}%
}{}%
\makeatother%
%% ================================================================================
%% ================================= listings *************************************
%% ********************************************************************************
\makeatletter%
\TUM@ifpackageloaded[setting]{listings}{%
	\TUMRequirePackage{packages/tumlistings}%
}{}%
\makeatother%
%% ================================================================================
%% ================================= tcolorbox ************************************
%% ********************************************************************************
\makeatletter%
\TUM@ifpackageloaded[setting]{tcolorbox}{%
%% loads: listings
\TUM@ifpackageloaded[setting]{listings}{%
	\tcbuselibrary{listings}%
}{}%
%% loads: amsmath
\tcbuselibrary{theorems}%
%% loads: tikz
\tcbuselibrary{skins}%
%% documentation: disables linkcolor, etc. from hyperref (extra macro then, etc.)
%\tcbuselibrary{documentation}%
%% breakable: option breakable
\tcbuselibrary{breakable}%
%% xparse: to use \DeclareTColorBox
\tcbuselibrary{xparse}%
%% equbox ... box for equations \begin{equbox}[title][opt.par.] ... \end{equbox}
%% Arguments same as "xparse"-package
\DeclareTColorBox[]{equbox}{+oO{}}{%
	title=\IfValueTF{#1}{#1}{},%
	fonttitle=\bfseries\boldmath,%
	coltitle=\TUMcolor{16}, coltext=\TUMcolor{17},%
	%% ***** no box:
	empty, borderline={\rulewidth}{0pt}{\TUMcolor{18}},%
	%% *****
	%% titlerule=0mm,%
	%% boxrule=0mm,%
	%% bottomrule=\rulewidth, toprule=\rulewidth,%
	%% leftrule=\rulewidth, rightrule=\rulewidth,%
	arc=0mm,%
	left=0mm,right=0mm,% only boxsep
	#2%
}%
%%  1. Definition%
%%  2. Bemerkung%
%%  3. Theorem (Satz)%
%%  3. Lemma (Hilfssatz), (Unterscheidung Theorem - Lemma ist subjektiv!)%
%%      3.1 Korollar (Triviale Folgerung eines Satzes)%
%%  (4.) Beweis%
%%  5. Beispiel%
%% proof exists, if amsthm is loaded%
\ifdefined\proof%
	\let\proof\relax\let\endproof\relax%
\else\fi%
\ifdefined\qed%
	\let\qed\relax%
\else\fi%
\TUM@ifpackageloaded[setting]{amssymb}{%
	\newcommand*{\qed}{\ensuremath{\square}}%
}{}%
%% \newtcbtheorem[use counter from= (z. B.) <(other) name>, <init options>]
%% {<name>}{<displayed name>}{<options>}{<prefix>}, prefix for nameref
\tcbset{%
defstyle/.style={%
	theorem style=plain,%
	separator sign none,% standard --
	description delimiters parenthesis,% standrad -- ()
	terminator sign colon,% standard -- :
	label separator=:,% standard -- :
	%% ***** no box:
	empty,%
	%% *****
	%% enhanced,%
	%% colframe=\TUMcolor{1},%
	coltitle=\TUMcolor{19},%
	description color=\TUMcolor{20},%
	fonttitle=\upshape\bfseries\boldmath,% titlefont (z. B.: Theorem 1.0)
	description font=\upshape\bfseries\boldmath,% description font (z. B.: "Titel")
	fontupper=\itshape,% textfont
	%% boxrule=\rulewidth, arc=0mm,%
	width=\linewidth, left skip=0mm, right skip=0mm,%
	boxsep=0mm, left*=0mm, right*=0mm, bottom=0mm, top=0mm,%
	},%
remstyle/.style={%
	defstyle,%
	breakable%
	},%
theostyle/.style={%
	defstyle%
	},%
lemstyle/.style={%
	defstyle%
	},%
corstyle/.style={%
	defstyle%
	},%
proofstyle/.style={%
	defstyle,%
	breakable,%
	after upper={\hfill\qed}%
	},%
examstyle/.style={%
	defstyle,%
	breakable%
	}%
}%
\AtBeginDocument{%
	\ifdefined\proofrefname\let\proofrefname\relax\else\fi%
	\ifdefined\definitionrefname\let\definitionrefname\relax\else\fi%
	\ifdefined\remarkrefname\let\remarkrefname\relax\else\fi%
	\ifdefined\theoremrefname\let\theoremrefname\relax\else\fi%
	\ifdefined\lemmarefname\let\lemmarefname\relax\else\fi%
	\ifdefined\corollaryrefname\let\corollaryrefname\relax\else\fi%
	\ifdefined\examplerefname\let\examplerefname\relax\else\fi%
	\newcommand*{\proofrefname}{}%
	\newcommand*{\definitionrefname}{}%
	\newcommand*{\remarkrefname}{}%
	\newcommand*{\theoremrefname}{}%
	\newcommand*{\lemmarefname}{}%
	\newcommand*{\corollaryrefname}{}%
	\newcommand*{\examplerefname}{}%
	\newcommand*{\postulaterefname}{}%
	\TUM@ifpackageloaded[setting]{babel}{% begin: babel loaded
		\AfterEndPreamble{%
			\addto\extrasamerican{%
				\renewcommand*{\proofrefname}{proof}%
				\renewcommand*{\definitionrefname}{definition}%
				\renewcommand*{\remarkrefname}{remark}%
				\renewcommand*{\theoremrefname}{theorem}%
				\renewcommand*{\lemmarefname}{lemma}%
				\renewcommand*{\corollaryrefname}{corollary}%
				\renewcommand*{\examplerefname}{example}%
			}%
			\addto\extrasenglish{%
				\renewcommand*{\proofrefname}{proof}%
				\renewcommand*{\definitionrefname}{definition}%
				\renewcommand*{\remarkrefname}{remark}%
				\renewcommand*{\theoremrefname}{theorem}%
				\renewcommand*{\lemmarefname}{lemma}%
				\renewcommand*{\corollaryrefname}{corollary}%
				\renewcommand*{\examplerefname}{example}%
			}%
			\addto\extrasnaustrian{%
				\renewcommand*{\proofrefname}{Beweis}%
				\renewcommand*{\definitionrefname}{Definition}%
				\renewcommand*{\remarkrefname}{Bemerkung}%
				\renewcommand*{\theoremrefname}{Theorem}%
				\renewcommand*{\lemmarefname}{Lemma}%
				\renewcommand*{\corollaryrefname}{Korollar}%
				\renewcommand*{\examplerefname}{Beispiel}%
			 }%
			\addto\extrasngerman{%
				\renewcommand*{\proofrefname}{Beweis}%
				\renewcommand*{\definitionrefname}{Definition}%
				\renewcommand*{\remarkrefname}{Bemerkung}%
				\renewcommand*{\theoremrefname}{Theorem}%
				\renewcommand*{\lemmarefname}{Lemma}%
				\renewcommand*{\corollaryrefname}{Korollar}%
				\renewcommand*{\examplerefname}{Beispiel}%
			 }%
		}%
	}{}%
}%
\newtcbtheorem[number within=chapter]{definition}{%
	\expandafter\MakeUppercase\definitionrefname}{defstyle}{def}%
\newtcbtheorem[number within=chapter]{remark}{%
	\expandafter\MakeUppercase\remarkrefname}{remstyle}{rem}%
\newtcbtheorem[number within=chapter]{theorem}{%
	\expandafter\MakeUppercase\theoremrefname}{theostyle}{theo}%
\newtcbtheorem[use counter from=theorem]{lemma}{%
	\expandafter\MakeUppercase\lemmarefname}{lemstyle}{lem}%
\newtcbtheorem[use counter from=theorem]{corollary}{%
	\expandafter\MakeUppercase\corollaryrefname}{corstyle}{cor}%
\newtcbtheorem[no counter]{proof}{%
	\expandafter\MakeUppercase\proofrefname}{proofstyle}{proof}%
\newtcbtheorem[number within=chapter]{example}{%
	\expandafter\MakeUppercase\examplerefname}{examstyle}{exam}%
%% No autoref supported, if necessary define it with \tcb@cnt@theoremautorefname...
%% , but if use counter from is used, then a new alias must be defined.
}{}% end: ifpackageloaded
\makeatother%
%% ================================================================================
%% ======================== style-commands (ExplSyntaxOn) *************************
%% ********************************************************************************
\ExplSyntaxOn%
\msg_new:nnn {tum-physics} {style/key_not_found} {}%
\msg_new:nnn {tum-physics} {style/style_not_defined} {}%
\prop_new:N \l_font_prop%
\prop_set_from_keyval:Nn \l_font_prop {%
	idxnumber = {\boldmath\bfseries\upshape},%
	1 = {\unboldmath\mdseries\itshape\leavevmode\color{\TUMcolor{27}}},% for emphasing text...
	2 = {\unboldmath\mdseries\itshape\leavevmode\color{\TUMcolor{28}}},%
	3 = {\unboldmath\mdseries\itshape\leavevmode\color{\TUMcolor{29}}},%
}%
\NewDocumentCommand{\TUMfont}{m}{%
	\prop_if_in:NnTF \l_font_prop {#1} {%
		\prop_item:Nn \l_font_prop {#1}%
	}{%
		\msg_set:nnnn {tum-physics} {style/key_not_found} {%
			Font~(#1)~not~defined.%
		}{}%
		\msg_warning:nn {tum-physics} {style/key_not_found}%
	}%
}%
\NewDocumentCommand{\newTUMfont}{mm}{%
	\prop_if_in:NnTF \l_font_prop {#1} {%
		\msg_set:nnnn {tum-physics} {style/key_not_found} {%
			Font~(#1)~already~defined.~Overwrite~font.%
		}{}%
		\msg_warning:nn {tum-physics} {style/key_not_found}%
	}{}%
	\prop_put:Nnn \l_font_prop {#1} {#2}%
}%
\NewDocumentCommand{\addTUMfont}{mm}{%
	\prop_if_in:NnTF \l_font_prop {#1} {%
		\prop_get:NnN \l_font_prop {#1} \l_font_tl
		\prop_put:Nnn \l_font_prop {#1} {\l_font_tl #2}%
	}{%
		\newTUMfont{#1}{#2}%
		\msg_set:nnnn {tum-physics} {style/key_not_found} {%
			Font~(#1)~not~defined.~Define~font.%
		}{}%
		\msg_warning:nn {tum-physics} {style/key_not_found}%
	}%
}%
\NewDocumentCommand{\removeTUMfont}{m}{%
	\prop_remove:Nn \l_font_prop {#1}%
}%
\NewExpandableDocumentCommand{\TUMstyle}{mm}%
{{%
	\str_case_e:nnTF {#1} {%
		{package}{%
			{\urlstyle{tt}\nolinkurl{#2}}%
		}%
		{1}{%
			{\TUMfont{1}#2}%
		}%
		{2}{%
			{\TUMfont{2}#2}%
		}%
		{3}{%
			\fbox{\TUMfont{3}#2}%
		}%
		{idxnumber}{%
			{\TUMfont{idxnumber}#2}%
		}%
	}{}{#2%
		\msg_set:nnnn {tum-physics} {style/style_not_defined} {%
			Style~(#1)~not~defined.%
		}{}%
		\msg_warning:nn {tum-physics} {style/style_not_defined}%
	}%
}}%
\ExplSyntaxOff%
%% ================================================================================
%% ================================ hyphenation ***********************************
%% ********************************************************************************
%% Hyphenation
\hyphenation{normalem uwforbf ulforem}%
%% ================================================================================
%% ========================== footnotes (Koma-Script) *****************************
%% ********************************************************************************
%% Multiple-footnotes enabled
\KOMAoptions{footnotes=multiple}%
\renewcommand*{\multfootsep}{,\nobreakspace}% %% \nobreakspace !
%% \blfootnote is a footnote without a number and the counter doesn't increment
\makeatletter%
\def\blfootnote{\xdef\@thefnmark{}\@footnotetext}%
\makeatother%
%% \setfootnoterule[Höhe]{Länge} %% falls die Länge des Strichs verändert werden soll
%% Hinweis: Mehrere Fussnoten zur gleichen Referenz werden mit \footref erzeugt
\makeatletter%
\@ifclassloaded{scrreprt}{%
	\counterwithout*{footnote}{chapter}%
	%\counterwithin*{footnote}{part}%
}{}%
\makeatother%
%% ================================================================================
%% ================================== siunitx *************************************
%% ********************************************************************************
\DeclareSIUnit{\dyne}{dyn}%
\DeclareSIUnit{\franklin}{Fr}%
\DeclareSIUnit{\statcoulomb}{statC}%
\DeclareSIUnit\clight{\text{\ensuremath{c}}}%
\DeclareSIUnit\year{a}%
\makeatletter%
\AtBeginDocument{%
	\TUM@ifpackageloaded[setting]{babel}{%
		\AfterEndPreamble{%
			\addto\extrasnaustrian{%
				\sisetup{output-decimal-marker = {,}}%
			}%
			\addto\extrasngerman{%
				\sisetup{output-decimal-marker = {,}}%
			}%
			\addto\extrasamerican{%
				\sisetup{output-decimal-marker = {.}}%
			}%
			\addto\extrasenglish{%
				\sisetup{output-decimal-marker = {.}}%
			}%
			\sisetup{group-minimum-digits=4, group-separator = \, ,%
			exponent-product=\cdot, output-product=\cdot,%
			separate-uncertainty = true,% uncertainty
			per-mode = symbol,% fraction-symbol (or: fraction)
			inter-unit-product = \,,%
			multi-part-units = single,% (or: brackets (standard))
			range-phrase = {--} ,% text mode: symbol/text like: (standard: ~to~)
			%% if math mode: then range-phrase = {\text{--}} ,
			detect-all,% detect-all: weight, family, shape, mode
			%% change for each table-row !
			table-number-alignment=center,%
			table-figures-integer=2, table-figures-decimal=2,%
			table-column-width=0.1\textwidth-2\tabcolsep%
			%table-figures-exponent=1,%
			%table-sign-exponent,%
			%table-sign-mantissa=true,% etc.
			}%
		}%
	}{}%
}%
\makeatother%
%% if one uses sansmath, then correct it with siunitx%
\makeatletter%
\TUM@ifpackageloaded[setting=false]{sansmath}{%
	\def\unboldmath{%
	 \@nomath\unboldmath%
	 \sansmath%
   }%
}{}%
\makeatother%
%% locale = UK = US:
%%  exponent-product = \ensuremath{\times}, inter-unit-product = \, ,
%%  output-decimal-marker = .
%% ================================================================================
%% ============================== babel & csquotes ********************************
%% ********************************************************************************
\makeatletter%
\TUM@ifpackageloaded[setting]{csquotes}{%
	\newcommand{\quoteb}{\openautoquote}%
	\newcommand{\quotee}{\closeautoquote}%
}{}%
\TUM@ifpackageloaded[setting]{babel}{%
	\useshorthands*{"}%
	\defineshorthand{"`}{\openautoquote}%
	\defineshorthand{"'}{\closeautoquote}%
}{}%
%% Switch shorthands from language to language
% \AtBeginDocument{%
%     \@ifpackageloaded{babel}{%
%       %\addto\extras...{\languageshorthands{...}}%
%     }{}%
% }%
\makeatother%
%% ================================================================================
%% ============================== graphicx & float ********************************
%% ********************************************************************************
\makeatletter%
\TUM@ifpackageloaded[setting]{graphicx}{%
	%% graphicspath{{path1}{path2}...{pathn}} adds the paths to \includegraphic[]{}
	\graphicspath{{images/titlepage/}{images/help/}{images/}%
	{images/external/images/tikz/}{images/tikz/}{images/appendix/}}%
}{}%
\makeatother%
%% Standard floatplacement's
\makeatletter%
\TUM@ifpackageloaded[setting]{float}{%
	\floatplacement{figure}{H}%
	\floatplacement{table}{H}%
}{}%
\makeatother%
\ExplSyntaxOn%
%% Messages for \includegraphicshelp
\msg_new:nnn {tum-physics} {includegraphics/missing_graphic} {}%
\NewDocumentCommand{\includegraphicshelp}{sO{}}{%
	\int_set:Nn \l_tmpa_int {\msg_line_number:}%
	\int_sub:Nn \l_tmpa_int {1}%
	\msg_set:nnnn {tum-physics} {includegraphics/missing_graphic} {%
		Missing~figure~(see~line~\int_use:N \l_tmpa_int).%
	}{}%
	\msg_warning:nn {tum-physics} {includegraphics/missing_graphic}%
	\IfBooleanTF{#1}{%
		\includegraphics*[#2]{help.png}%
	}{%
		\includegraphics[#2]{help.png}%
	}%
}%
\ExplSyntaxOff%
%% ExplSyntaxOff for: \@todonotes@MissingFigureText
\makeatletter%
\NewDocumentCommand{\todoincludegraphics}{sO{}m}{}%
\AtBeginDocument{%
	\TUM@ifpackageloaded[setting]{todonotes}{%
		\RenewDocumentCommand{\todoincludegraphics}{sO{}m}{%
			\if@todonotes@disabled\else%
				\phantomsection%
				\addcontentsline{tdo}{todo}{\@todonotes@MissingFigureText: #3}%
			\fi%
			\IfBooleanTF{#1}{\includegraphicshelp*[#2]}{\includegraphicshelp[#2]}%
		}%
	}{%
		\RenewDocumentCommand{\todoincludegraphics}{sO{}m}{%
			\IfBooleanTF{#1}{\includegraphicshelp*[#2]}{\includegraphicshelp[#2]}%
		}%
	}%
}%
\makeatother%
%% ================================================================================
%% ======================== subfig, caption & subcaption **************************
%% ********************************************************************************
%% Set the style of the captionlabel/caption
\setkomafont{captionlabel}{\normalsize\bfseries}%
\setkomafont{caption}{\normalsize}%
\KOMAoption{captions}{bottombeside}%
\makeatletter%
\TUM@ifpackageloaded[setting=false]{subfig}{%
	\renewcommand\p@subfigure{\thefigure.}%
	\renewcommand\p@subtable{\thetable.}%
}{}%
\TUM@ifpackageloaded[setting]{caption}{%
	\TUM@ifpackageloaded[setting]{hyperref}{%
		\captionsetup{hypcap=true}%
	}{}%
	%\captionsetup[table]{position=top}% KOMA-option is stronger (automatically)
	%\captionsetup[figure]{position=bottom}% KOMA-option is stronger (automatically)
	\captionsetup{rule=false}% reset make@caption to KOMA-Script,%
	\captionsetup[subtable]{labelformat=simple,labelsep=period,listformat=simple}%
	\captionsetup[subfigure]{labelformat=simple,labelsep=period,listformat=simple}%
	\captionsetup{format=plain}%
}{}%
\TUM@ifpackageloaded[setting]{subcaption}{%
	\renewcommand\p@subfigure{\thefigure.}%
	\renewcommand\p@subtable{\thetable.}%
}{}%
\makeatother%
%% ================================================================================
%% =================================== tables *************************************
%% ********************************************************************************
%% Neue Spaltenparameter :D (praktisch)
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}%
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}%
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}%
\newcolumntype{M}[1]{>{\raggedright\arraybackslash}m{#1}}%
\newcolumntype{N}[1]{>{\centering\arraybackslash}m{#1}}%
\newcolumntype{O}[1]{>{\raggedleft\arraybackslash}m{#1}}%
\newcolumntype{Z}[3]{>{#3\arraybackslash}#1{#2}}%
\makeatletter%
\TUM@ifpackageloaded[setting]{tabularx}{%
	\newcolumntype{A}{>{\centering\arraybackslash}X}%
	\newcolumntype{B}{>{\raggedleft\arraybackslash}X}%
}{}%
\TUM@ifpackageloaded[setting]{array}{%
	\newcommand\undefcolumntype[1]{%
		\expandafter\let\csname NC@find@#1\endcsname\relax%
	}%
}{}%
\makeatother%
%% Damit einzelne Tabellenabschnitte links-, rechtsbuendig / zentriert werden:
\newcommand{\ltab}{\raggedright\arraybackslash}%
\newcommand{\ctab}{\centering\arraybackslash}%
\newcommand{\rtab}{\raggedleft\arraybackslash}%
%% ================================================================================
%% ==============  Definition of the header/footer-style and matters **************
%% ********************************************************************************
%% ---------------------- Definition of the matters/pagestyle ---------------------
%% If report, then copy matters from book,
\makeatletter%
\@ifclassloaded{scrreprt}{%
	\newif\if@mainmatter\@mainmattertrue%
	\newcommand*\frontmatter{%
		\if@twoside\cleardoubleoddpage\else\clearpage\fi%
		\@mainmatterfalse\pagenumbering{roman}%
	}%
	\newcommand*\mainmatter{%
		\if@twoside\cleardoubleoddpage\else\clearpage\fi%
		\@mainmattertrue\pagenumbering{arabic}%
	}%
	\newcommand*\backmatter{%
		\if@openright\cleardoubleoddpage\else\clearpage\fi\@mainmatterfalse%
	}%
}{}%
\makeatother%
%% -------------------------- Definition of the head/foot -------------------------
\TUMRequirePackage{packages/tumheader}%
%% ---------------------- Definition of the matters/pagestyle ---------------------
%% after: tumheader
\TUMRequirePackage{packages/tummatter}%
%% ================================================================================
%% =================================== Abstract ***********************************
%% ********************************************************************************
\renewcaptionname{american}{\abstractname}{Abstract}%
\renewcaptionname{naustrian}{\abstractname}{Resümee}%
\ifcsmacro{abstract}{%
	\renewenvironment{abstract}{%
		\addchap{\abstractname}%
	}{}%
}{%
	\newenvironment{abstract}{%
		\addchap{\abstractname}%
	}{}%
}%
%% ================================================================================
%% ========================== Declaration of Authorship ***************************
%% ********************************************************************************
\makeatletter%
\AtBeginDocument{%
	\newcommand*{\declarationofauthorshipname}{}%
	\TUM@ifpackageloaded[setting]{babel}{% begin: babel loaded
		\AfterEndPreamble{%
			\addto\extrasnaustrian{%
				\renewcommand*{\declarationofauthorshipname}{Eidesstattliche Erklärung}%
			}%
			\addto\extrasngerman{%
				\renewcommand*{\declarationofauthorshipname}{Eidesstattliche Erklärung}%
			}%
			\addto\extrasamerican{%
				\renewcommand*{\declarationofauthorshipname}{Declaration of Authorship}%
			}%
			\addto\extrasenglish{%
				\renewcommand*{\declarationofauthorshipname}{Declaration of Authorship}%
			}%
		}%
	}{}%
}%
\makeatother%
%% ================================================================================
%% ================================ Acknowledgments *******************************
%% ********************************************************************************
\makeatletter%
\AtBeginDocument{%
	\newcommand*{\acknowledgmentsname}{}%
	\TUM@ifpackageloaded[setting]{babel}{% begin: babel loaded
		\AfterEndPreamble{%
			\addto\extrasnaustrian{%
				\renewcommand*{\acknowledgmentsname}{Danksagung}%
			}%
			\addto\extrasngerman{%
				\renewcommand*{\acknowledgmentsname}{Danksagung}%
			}%
			\addto\extrasamerican{%
				\renewcommand*{\acknowledgmentsname}{Acknowledgments}%
			}%
			\addto\extrasenglish{%
				\renewcommand*{\acknowledgmentsname}{Acknowledgments}%
			}%
		}%
	}{}%
}%
\makeatother%
%% ================================================================================
%% ============================= Seiteneinstellungen ******************************
%% ********************************************************************************
%% Set the space between lines with \onehalfspacing or \singlespacing (setspace)
%% Set the length of \parskip (ver. Einrueckung nach einem Umbruch)
%% Set the \parindent to 0 (hor. Einrueckung nach einem Umbruch)
%% \singlespacing% (setspace-package option)
\setlength{\parskip}{0pt plus1pt}% ("standard")
%% \setlength{\parindent}{0pt}%
%% ================================================================================
%% =================== Definition of the section, sub-... style *******************
%% ********************************************************************************
%% ----------------------------- Section-/...-styles ------------------------------
\addtokomafont{disposition}{\boldmath\bfseries\sffamily}%
%% Extra package to change section-style (underline)%
%\TUMRequirePackage{packages/Ex-tumsections}%
%% --------------------- dynamische Nummernbreitenberechnung ----------------------
\makeatletter%
\newcommand*\TUM@pagenumberbox[1]{#1}%
\DeclareTOCStyleEntries[%
dynnumwidth=true,% necessary if e.q. 14.10 in section
pagenumberbox=\TUM@pagenumberbox% necessary if pagenumber > 100 (and e.q. bold-font)
]{tocline}{part,chapter,section,subsection,subsubsection,figure,table}%
\makeatother%
%% ================================================================================
%% ================================ Keywords ======================================
%% ********************************************************************************
\makeatletter%
\ExplSyntaxOn%
\clist_new:N \l_TUM@keywords_clist%
\NewDocumentCommand{\@TUM@keywords}{m}{%
	\clist_put_right:Nn \l_TUM@keywords_clist {#1}%
}%
\clist_set:Nx \l_TUM@keywords_clist {%
	Technische~Universit\"at~M\"unchen,TUM,%
	Fakult\"at~f\"ur~Physik,Physik,Bachelor~Thesis%
}%
\AtBeginDocument{%
	\pdfkeywords{\clist_use:Nnnn \l_TUM@keywords_clist {;} {;} {;}}%
	\hypersetup{%
		pdftitle={\@pdftitle},%
		pdfsubject={\@pdfsubject},%
		pdfauthor={\@pdfauthor},%
		pdfkeywords={\@pdfkeywords},%
		%pdfcreator={...},% LaTeX with hyperref
		%pdfproducer={...},% MiKTeX pdfTeX-1.40.21
	}%
}%
\ExplSyntaxOff%
\makeatother%
%% ================================================================================
%% ================================= Note columns =================================
%% ********************************************************************************
\makeatletter%
\TUM@ifpackageloaded[normal]{scrlayer-notecolumn}{%
	\TUMRequirePackage{packages/tumnote}%
}{}%
\makeatother%
%% ================================================================================
%% ==================== TOC/LOF/LOT/LOB/LOL/IDX/TDO/titlepage =====================
%% ********************************************************************************
\TUMRequirePackage{packages/tumtoc}%
\TUMRequirePackage{packages/tumlof}%
\TUMRequirePackage{packages/tumlot}%
\makeatletter%
\TUM@ifpackageloaded[setting]{biblatex}{%
	\TUMRequirePackage{packages/tumlob}%
}{}%
\TUM@ifpackageloaded[setting]{listings}{%
	\TUMRequirePackage{packages/tumlol}%
}{}%
\TUM@ifpackageloaded[setting]{imakeidx}{%
	\TUMRequirePackage{packages/tumidx}%
}{}%
\TUM@ifpackageloaded[setting]{todonotes}{%
	\TUMRequirePackage{packages/tumtdo}%
}{}%
\makeatother%
\TUMRequirePackage{packages/tumtitlepage}%
%% ================================================================================
%% ===================================== TUM ? ====================================
%% ********************************************************************************
%\tolerance 1414
%\hbadness 1414
%\emergencystretch 1.5em
%\hfuzz 0.3pt
\widowpenalty=10000%
\clubpenalty=10000%
\displaywidowpenalty=10000%
%\vfuzz \hfuzz
\raggedbottom%
\endinput%